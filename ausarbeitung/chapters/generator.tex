\chapter{Evaluation}

Um den implementierten Algorithmus zu testen, werden sowohl reale als auch synthetische Datenbanken verwendet. Die generierte synthetische Datenbank stellt eine Vielzahl von verschiedenen Testbildern bereit. Ein Vorteil dieser ist, dass die Parameter der generierten Testbilder manuell eingestellt werden können. Dies ermöglicht eine einfache Analyse, unter welchen Umständen die implementierte QR-Detektion scheitert.

\section{Ablauf der synthetischen Generierung}

Der Generator liest einen Ordner von \emph{Ground Truth} Bildern ein. Diese bestehen aus randlosen \QRCodes mit einem Pixel pro Modul. Auf den eingelesenen Bildern werden der Reihe nach die in Tabelle \ref{tab:syntorder} aufgelisteten Operationen ausgeführt, und für jede Operation die Zwischenergebnisse in einem entsprechenden Ordner gespeichert.\\\\
\texttt{Input}: Menge von \emph{Ground Truth} \QRCodes \\
\texttt{Output}: Datenbank von synthetischen Bildern

\begin{table}[h]
\begin{multicols}{2}
\begin{enumerate}
	\item Randerstellung
	\item Skalierung
	\item Rotation
	\item Perspektivische Transformation
	\item Einbettung in Hintergründe
	\item Gaußglättung
	\item Rauschen
\end{enumerate}
\end{multicols}
\caption{Operationreihenfolge beim Generieren der synthetischen Datenbank.}\label{tab:syntorder}
\end{table}

%Hier Bilder für Generierung hinzufügen?

\noindent Pro Operation kann festgelegt werden, wie viele Dateien generiert und gespeichert werden sollen.
Für jede Operation werden diskrete Schrittweiten und Start und Endwerte angegeben. So zum Beispiel:
\begin{itemize}
	\item Rotation: Diskretisierung in $45$\textdegree\xspace Schritten
	\item Gaußglättung: Startwert von $n=3$, Schrittweite von $6$, Maximalwert von $n=27$
	\item ...
\end{itemize}
Die diskreten Schrittweiten pro Operation sind gleich verteilt, sodass möglichst alle Variationen abgedeckt werden.


\newpage
\section{Testergebnisse}
Das Anwenden des implementierten QR-Detektors auf alle Zwischenergebnisse der synthetischen Datenbank liefert folgende Ergebnisse, dabei ist die Qualität durch die relative Übereinstimmung der erkannten \QRCodes mit den \emph{Ground-Truth} Bildern gegeben. Besitzt der ausgegebene \QRCode die falsche Dimension wird er als nicht erkannt gewertet.
\begin{table}[h]
\centering
\begin{tabular}{l c c c c}
 		& Anzahl & Erkannt & Qualität & Parameter \\
		Skalierung & $60$ & $60$ & $98\%$ & $s=6$,IL, IN \\
		Rotation  & $420$ & $420$ & $97.35\%$ & $0<r<360$, $k=45$\\
		Perspektive & $1000$ & $935$ & $95.6\%$ & $0 \leq x,y<0.3$, $k=0.1$\\
		Einbettung & $300$ & $268$ &  $96.82$ & $d=60\%$\\
		Glättung & $200$ & $131$ & $94.4\%$ &  $5\leq n \leq 23$, $k=6$\\
		Rauschen & $200$ & $116$ & $95.24\%$ & \o$=0$, $15 \leq \sigma \leq 45$, $k=15$\\
\end{tabular}
\begin{flushleft}
\begin{tabular}{l c l}
$s$ &$\widehat{=}$& Skalierungsfaktor\\
IL &$\widehat{=}$& lineare Interpolation\\
IN &$\widehat{=}$& nearest neighbour Interpolation\\
$k$ &$\widehat{=}$& diskrete Schrittweite\\
$r$ &$\widehat{=}$& Rotationswinkel\\
$(x, y)$ &$\widehat{=}$& Position der oberen linken Ecke in Prozent bzgl. Dimension des Bildes\\
$d$ &$\widehat{=}$& Größe des \QRCodes innerhalb des Hintergrundes entlang der kleinsten Achse\\
$n$ &$\widehat{=}$& Nachbarschaft\\
\o &$\widehat{=}$& Mittelwert\\
$\sigma$ &$\widehat{=}$& Standardabweichung
\end{tabular}
\end{flushleft}
\caption{Evaluation der synthetischen Datenbank.}
\end{table}

\noindent Die Datenbanken von abfotografierten \QRCodes \cite{databasebrno} stammen von einer Forschungsgruppe der \emph{Brno University of Technology}. Die Bilder zeigen \QRCodes umschlossen von Text, unter verschiedenen Belichtungsszenarien, in realen Arbeitsumgebungen, in der freien Natur oder vor künstlichen, besonders gekachelten Hintergründen.

Für diese \QRCodes sind \emph{Ground Truth} Bilder vorhanden, jedoch nicht in dem Format, wie sie für automatisierte Qualitätsvergleiche von der Implementierung des QR-Code-Detektors erwartet wird. Deswegen wird anstelle der Qualität nur die Erkennungsrate angegeben. Die Laufzeiten beziehen sich dabei auf die Erkennung von \QRCodes mit anschließender Ausgabe von \emph{Debug} Bildern.

\begin{table}[h]
\centering
\begin{tabular}{l c c c c}
 		& Anzahl & Erkannt & Erkennungsrate & Laufzeit \\
		dataset1 & $410$ & $227$ & $55.3\%$ & $\approx100$s \\
		dataset2 & $400$ & $300$ & $75\%$ & $\approx20$s \\
\end{tabular}
\caption{Evaluation von Foto Datenbanken.}
\end{table}

\newpage
\section{Auswertung}
Bei der synthetischen Datenbank zeigt sich, dass Skalierung, Rotation und Perspektivische Verzerrung keine Nennenswerten Probleme für die Detektion von \QRCodes darstellen. Die einzigen Ausreißer beschränken sich auf \QRCodes mit hoher Versionsnummer oder sehr extremen Perspektiven.

Die Verluste der erkannten \QRCodes von Perspektive zu Einbettung, sind den kumulativen Effekten der erneuten Skalierung zuzuschreiben. Insbesondere Große \QRCodes besitzen nach diesem Vorgang teilweise keine ausreichend großen \fps mehr.
Bei der Glättung und dem Rauschen kommt es durch weitere kumulative Effekte zu noch mehr schwierigen Situationen, sodass selbst das menschliche Auge langsam versagt.
Die Einzelnen Komponenten stellen für den implementierten QR-Code-Detektor keine Schwierigkeit dar, jedoch kann ein Zusammenspiel der Komponenten den QR-Code-Detektor an seine Grenzen bringen. Insbesondere das Rauschen und die Glättung hatten starke Effekte auf die Erkennungsrate.

Ist der Detektor aber in der Lage die \fps zu lokalisieren, so extrahiert er im Durchschnitt mit sehr guter Qualität die gefundenen \QRCodes.
Einen Schluss den wir aus diesen Ergebnissen ziehen, ist dass der Detektor am ehesten von einer Verbesserung der Lokalisierung der \fps profitiert. Dies könnte zum Beispiel durch besser geeignete Schwellenwerte bei der Binarisierung geschehen. Eine erste einfache Verbesserung wäre zum Beispiel die zurzeit mit $0$ gewählte Konstante \texttt{C} bei der Binarisierung auf einen sinnvolleren Wert zu setzen. Dies würde der derzeitig starken Körnung von adaptiv binarisierten Bildern entgegenwirken und die Konturdetektion verbessern.
\\
Bei der Foto Datenbank zeigt sich eine grundlegende Schwäche der Lokalisierung von \fps durch Konturen. Selbst kleine Verletzungen der \emph{Quietzone} durch, wie in diesem Fall, Text oder Schmutz führen direkt zu einem Versagen der Lokalisierung der \fps. Zudem stellen starke Beleuchtungsunterschiede immer noch ein schwieriges Hindernis dar, trotz adaptiven Schwellwertverfahren für die Binarisierung. Beispielsweise ein kräftiger Schatten, der quer durch den \QRCode verläuft.

Szenarien die komplexe Probleme für klassische auf Hough-Transformation basierende Detektoren bereitstellten, sind jedoch problemlos gelöst worden. Auch mehrere \QRCodes in einem Bild direkt nebeneinander oder über das Bild verteilt stellen kein Problem dar, solange alle \fps gefunden werden.

Auch hier zeigt sich wieder, wie schon bei der synthetischen Datenbank, dass die Lokalisierung der \fps das derzeit größte Problem für den implementierten Detektor darstellt.